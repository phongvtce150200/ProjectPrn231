@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "~/Views/Shared/_LayoutDoctor.cshtml";
}
@model IEnumerable<Medicine>
<hr />
<div>
    <table class="table table-hover">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Medicine Name</th>
                <th scope="col">Price</th>
                <th scope="col">Expiration</th>
                <th scope="col">Amount</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody id="medicineBody">
        </tbody>
    </table>
</div>
<div class="modal fade" id="EditexampleModal" tabindex="-1" aria-labelledby="EditexampleModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EditexampleModal">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <form asp-action="UpdateMedicine" asp-controller="Medicine" method="post">
                    <div class="form-group">
                        <input type="text" id="medicineName" class="form-control" placeholder="Medicine Name" style="text-align: center;" />
                        <span name="medicineName" class="text-danger"></span>
                    </div>


                    <div class="row justify-content-between d-flex" style="margin-bottom : 8px; margin-top: 8px;">
                        <div class="form-group col-md-6">
                            <input type="text" id="price" class="form-control" placeholder="Price" style="text-align: center;" />
                            <span name="price" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-6">
                            <input type="date" value="expiration" id="expiration" class="form-control" placeholder="Expiration" style="text-align: center;" />
                            <span name="expiration" class="text-danger"></span>
                        </div>
                    </div>

                    <div class="form-group">
                        <input type="text" id="amount" class="form-control" placeholder="Amount" style="text-align: center;" />
                        <span name="amount" class="text-danger"></span>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <input type="submit" class="btn btn-primary" value="Save Change" />
                    </div>
                </form>

            </div>
        </div>
    </div>
</div>
@section Scripts{
    <script>
        medicineList = [];
        LoadMedicine();
        function LoadMedicine() {
            var tr = ``;
            $.ajax({
                url: "https://localhost:5001/api/Medicine",
                type: 'GET',
                dataType: 'json', // added data type
                success: (result) => {
                    medicineList = result
                    $.each(result, (k, v) => {
                        tr +=
                            `<tr>
                                <th scope="row">${v.medicineId}</th>
                                <td>${v.medicineName}</td>
                                <td>${v.price}</td>
                                <td>${v.expiration}</td>
                                <td>${v.amount}</td>
                                <td>
                                    <button href="#" value="${k}" class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#EditexampleModal" name="btnEdit">Edit</button>
                                </td>                                                                                                              
                            </tr>`
                    })
                    $("#medicineBody").html(tr);
                    assignClickEvent();
                },
                error: (error) => {
                    console.log(error)
                }
            });
        };

        function assignClickEvent() {
            $("button[name='btnEdit']").click((e) => {
                let id = e.currentTarget.value;
                console.log(id);
            });
        }

    </script>
}